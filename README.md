JBoss BRMS Examples
===

# Installation
* copy .niogit from the support folder to EAP_HOME/bin
* In your EAP configuration EAP_HOME/standalone/configuration/application-roles.properties
* Your user must have the "kie-server" role
* Build & Deploy specific rule projects
  * example / Test / brmstest
  * example / Example / MyExample
  
# Rule Execution Server Creation (Realtime Decision Server) 
* From Business Central
* Deploy -> Rule Deployments -> Register
  * Endpoint: http://localhost:8080/kie-server/services/rest/server
  * Name: Test Server
  * User/Password: account with kie-server role
* Click the "+" to the right of your new "Test Server Name", this will create the container
  * Name: [container_name]
  * Valid GAV (get this from the Project Editor of your project) / or use the search mechanism, search for: [gav]
  * Click the radio button of your new container and click Start on the right
  * If you click on the right arrow of [container_name], you can see the endpoint:
    * http://localhost:8080/kie-server/services/rest/server/containers/[container_name]

# Rule examples - general (brmstest)
* example / Test / brmstest
* Rule execution server container settings
  * Group Name: com.redhat.test
  * Artifact Id: brmstest
  * Version: 1.0.1 
  
# Rule example - data model with collection (MyExample)
* example / Example / MyExample
* Rule execution server container settings
  * Group Name: com.redhat.example
  * Artifact Id: MyExample
  * Version: 1.0.5

# Rule Execution Server Payload Generation
* Use the project brms-rule-service - RuleExecutionXmlPayloadGen POJO to generate your payload
* https://github.com/kenthua/brms-example/blob/master/project/brms-rule-service/README.md 

# Invoking the Rule Execution Server from REST Client
* Call out to the new container and see what response you get back
* Endpoint / URL: http://localhost:8080/kie-server/services/rest/server/containers/[container_name]
* REST Info
  * HTTP POST
  * Header: Content-Type = application/xml
* XML Request Payload example (see document end for specific use cases):

    <batch-execution>
      <insert out-identifier="customer" return-object="true" entry-point="DEFAULT">
      ...
      </insert>
    <fire-all-rules/>
    </batch-execution>
     
# Rule Execution / Testing - Non-execution server
* Build the brms-demo project as a war and add to the EAP_HOME/standalone/deployments folder
  * Build & Deploy rule project
  * BRMSServiceImpl has a main method, just run the class by itself via JBDS
  *   OR
  * brms-demo project -> mvn package 
  * copy the .war in the target folder (EAP_HOME/standalone/deployments)
  * http://localhost:8080/brms-demo/ListenServlet
    * Listen Servlet initializes test data
    * BRMSServiceImpl calls for a ksession, copies data from model to BRMS fact
    * Depends kmodule/jar being generated by JBoss BRMS for fact model
    * Once executed will run through rules written for the data
* Don't expect anything in return, watch the EAP system out (server.log) for messages of rules being executed.


# Payload Example - brmstest

    <batch-execution>
      <insert out-identifier="customer" return-object="true" entry-point="DEFAULT">
        <com.redhat.test.brmstest.fact.Customer>
          <accountCount>0</accountCount>
          <firstName>John</firstName>
          <lastName>Doe</lastName>
        </com.redhat.test.brmstest.fact.Customer>
      </insert>
      <insert out-identifier="account" return-object="true" entry-point="DEFAULT">
        <com.redhat.test.brmstest.fact.Account>
          <balance>100.0</balance>
          <customer reference="../../../insert/com.redhat.test.brmstest.fact.Customer"/>
          <number>C-12345</number>
          <type>CHECKING</type>
        </com.redhat.test.brmstest.fact.Account>
      </insert>
      <fire-all-rules/>
    </batch-execution>

# Payload Example - MyExample

    <batch-execution>
      <insert out-identifier="customer" return-object="true" entry-point="DEFAULT">
        <com.redhat.example.myexample.Customer>
          <id>1</id>
          <firstName>John</firstName>
          <accounts>
            <com.redhat.example.myexample.Account>
              <type>CHECKING</type>
              <balance>10.0</balance>
            </com.redhat.example.myexample.Account>
            <com.redhat.example.myexample.Account>
              <type>SAVINGS</type>
              <balance>20.0</balance>
            </com.redhat.example.myexample.Account>
          </accounts>
        </com.redhat.example.myexample.Customer>
      </insert>
      <fire-all-rules/>
    </batch-execution>


Refreshed for BRMS/BPM Suite 6.1

